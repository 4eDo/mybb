# Скрипт для изменения баланса игрока прямо со страницы банка
> **NB! В сообщении не сохраняется никакой таблицы. Выводимая информация носит справочный характер и пропадает после обновления страницы. Для маркировки используйте настройку обёртывания.**

## Инструкция:
### 1. Скопировать всё из файла `edit_field_on_fly.min.html`
Скрипт там лежит в сжатом виде. Это позволяет не отвлекаться на ненужные для вас строки. Если хочется что-то поменять под себя - пожалуйста. Файл `edit_field_on_fly.html` содержит весь код.

### 2. Администрирование -> Формы
Код вставляется в html-низ. **РЕКОМЕНДУЮ** вставлять в HTML низ (тестовый), но можно и в основной. Тестовый хорош тем, что по умолчанию будет грузиться только у администраторов (опционально - и у модераторов).

### Изменение параметров
Параметры, которые вы можете настраивать:
- `const FIELD_ID_FOR_EDIT = "fld1";` - идентификатор поля, в котором хранится ваш кошелёк. Не забудьте fld и не сотрите кавычки.

- `const ADD_CACHE_TEXT = "Изменение баланса";` - текст на кнопке в банке. Она будет видна только вам.

- `const COLOR_INPUT_TEXT = "color: #000000 !important";` - на некоторых форумах дизайнеры играются со стилями так, что цвет текста в полях input нечитаем. Это исправляет недочёт. Но если ваш дизайнер - умничка и солнышко, тщательно прописывающее все селекторы, то можно оставить `const COLOR_INPUT_TEXT = "";`

- `const ALLOWED_TOPICS = ['1', '2', '3']; // С кавычками` - это идентификаторы ТЕМ, в которых будет доступна кнопка изменения баланса. Не забывайте вокруг идентификатора писать кавычки!

- `const ALLOWED_GROUPS = [1]; // БЕЗ кавычек` - проверка, кому можно этим пользоваться. Группа 1 - администроторы, 2 - модераторы. Чтобы разрешить администраторам и модераторам, напишите `const ALLOWED_GROUPS = [1, 2];` Кавычки вокруг номера группы не нужны

- список опций, которые будут доступны в выпадающем списке.
  - _Первое значение_ - наименование, то, как будет отображаться в списке.
  - _Второе_ - коэффициент, на который будет домножаться количество (сюда можно включить что-то часто используемое вроде награды за конкурс или оплату твинка).
  - _Третье_ - идентификаторы тем, где опция доступна. Записывать через пробел. Если опция должна быть доступна во всех темах из списка `ALLOWED_TOPICS`, то указывать `all`
```
const OPERATIONS = [ // Наименование опции, коэффициент, в каких топиках есть (через пробел) или all
	["Начисление", "1", "all"],
	["Списание", "-1", "all"],
	["От большой любви", "5", "1 2"],
	["От маленькой любви", "0.1", "1 3"],
	["От большой нелюбви", "-5", "1 2"],
	["От маленькой нелюбви", "-0.1", "1 3"],
];
```
- `const ROUND = 2; // Если допускается дробный баланс, укажите кол-во знаков после запятой` -  Возможен ли дробный баланс.
  - Если дробный баланс запрещён, указывайте 0. Иначе пишите количество знаков после запятой. Если запрещено, то дробная часть отбрасывается. Иначе происходит округление.
  - if 0 then 0.5555555 -> 0		1.999 -> 1
  - if 1 then 0.5555555 -> 0.6
  - if 2 then 0.5555555 -> 0.56
  - if 3 then 0.5555555 -> 0.556

- `const USE_WRAPPER = true; // false, если не хотите, чтобы сообщение как-то помечалось`
  - Оборачивает пост пользователя в спойлер. Если вам это не нужно, куазывайте `false`

- Шаблон, по которому оборачивается пост. Можно менять под свои нужды
  - {{ADMIN_NAME}} - имя админа
  - {{CACHE_BEFORE}} - баланс до изменения
  - {{CACHE_AFTER}} - баланс после изменения
    
- Этот блок будет вставлен ДО сообщения пользователя
```
const WRAPPER_START = `[spoiler="[table layout=auto width=100]
[tr]
[td][b]ОБРАБОТАНО[/b] ({{ADMIN_NAME}})[/td]
[td][b]Было[/b]: {{CACHE_BEFORE}}[/td]
[td][b]Стало[/b]: {{CACHE_AFTER}}[/td]
[/tr]
[/table]"]`
```

- Этот блок будет вставлен ПОСЛЕ сообщения пользователя
```const WRAPPER_END = `[/spoiler]`;```

- Псевдоним вместо логина админа. Если не надо, то оставить `const ADMIN_NAMES = {}`
  - Если id есть в таблице ниже, будет подставлено имя из неё. Иначе будет имя профиля.
```
const ADMIN_NAMES = { // id, ник для подстановки
	1: "Кот админа",
	3: "Люто Страшный Админ",
}
```

### Тестирование
В теме банка создайте с тестового аккаунта какое-нибудь сообщение. На нём тестируете. Не стоит проверять на живых профилях, потому что в случае ошибки вы можете не вспомнить, что и как было.
