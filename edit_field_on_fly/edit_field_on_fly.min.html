<script id="efof">
    const FIELD_ID_FOR_EDIT = "fld1";
    const ADD_CACHE_TEXT = "Изменение баланса";
    const COLOR_INPUT_TEXT = "color: #000000 !important";
    const ALLOWED_TOPICS = ['1']; // С кавычками
    const ALLOWED_GROUPS = [1]; // БЕЗ кавычек

    var currentTopic=$get.id;$(document).ready(function(){if(ALLOWED_GROUPS.includes(GroupID)&&ALLOWED_TOPICS.includes(currentTopic)){console.group("4eDo script edit_field_on_fly "),console.log("%c~~ Скрипт для быстрого начисления/списания средств. %c https://github.com/4eDo ~~","font-weight: bold;","font-weight: bold;"),console.groupEnd();const t=$(".post-rating");let n=0;t.each(function(){const t=$(this),e=t.closest("[data-user-id]").data("user-id"),o=$("<div></div>"),d=$('<input type="button" />').addClass("edit_on_fly button preview").val(ADD_CACHE_TEXT).css("cursor","pointer").on("click",function(){c.show()}),i=$("<select></select>").attr("id",`select-type-${n}`).on("change",function(){s.toggle("0"!==i.val())});i.append('<option value="0">Не выбрано</option>').append('<option value="add">начисление</option>').append('<option value="subtract">списание</option>');const c=$("<p>Тип операции: </p>").hide().append(i),p=$('<input type="number" min="0" />').attr("style",COLOR_INPUT_TEXT).attr("id",`input-count-${n}`).on("input",function(){r.toggle(p.val()>0)}),s=$("<p>Количество: </p>").hide().append(p),r=$('<input type="button" />').addClass("edit_on_fly button submit").val("Выполнить").hide().css("cursor","pointer").on("click",function(){const t=i.val(),n=p.val();r.prop("disabled",!0),c.css("opacity","0.5").css("pointer-events","none"),s.css("opacity","0.5").css("pointer-events","none"),r.css("opacity","0.5").css("pointer-events","none"),function(t,n,e,o,d,i){const c=document.createElement("iframe");c.style.display="none",document.body.appendChild(c),c.src=window.location.origin+"/profile.php?section=fields&id="+e,c.onload=function(){const e=c.contentDocument||c.contentWindow.document;if(!e){const t=$('<p class="editOnFly_error">Произошла ошибка.</p>');return i.append(t),void document.body.removeChild(c)}const o=e.querySelector('input[name="form['+FIELD_ID_FOR_EDIT+']"]'),d=e.querySelector("#profile8 > p > input");if(!o){const t=$('<p class="editOnFly_error">Произошла ошибка.</p>');return i.append(t),void document.body.removeChild(c)}{let e=parseInt(o.value)||0;const c=e;if("add"===t?e+=parseInt(n):"subtract"===t&&(e-=parseInt(n)),o.value=e,d){d.click();const o=$(`\n  <table class="editOnFly_success" border="1" style="margin-top: 10px;">\n      <tr>\n          <td>Тип операции:</td>\n          <td>${"add"===t?"начисление":"списание"}</td>\n      </tr>\n      <tr>\n          <td>Количество:</td>\n          <td>${n}</td>\n      </tr>\n      <tr>\n          <td>Было:</td>\n          <td>${c}</td>\n      </tr>\n      <tr>\n          <td>Стало:</td>\n          <td>${e}</td>\n      </tr>\n  </table>\n  <p>Новые значения будут видны после обновления страницы.</p>\n`);i.append(o)}}c.onload=function(){document.body.removeChild(c)}},c.onerror=function(){const t=$('<p class="editOnFly_error">Произошла ошибка.</p>');i.append(t),document.body.removeChild(c)}}(t,n,e,0,0,o)});o.append(d,c,s,r),t.after(o),n++})}else $("#efof").remove()});
</script>